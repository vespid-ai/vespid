# ADR 0004: Open Core Licensing and Boundary Strategy

## Status
Accepted

## Context
Vespid is an application-layer workflow SaaS with a strong multi-tenant control plane.
We need to:
- remain a real open source project for community core,
- protect enterprise differentiation,
- support both vendor-hosted SaaS and private deployment business models,
- avoid accidental leakage of proprietary modules.

## Decision
We adopt an Open Core model with explicit directory-level licensing boundaries.

Licensing model:
- Community Core: `AGPL-3.0-only`
- Ecosystem SDK/Client packages (`packages/sdk-*`): `Apache-2.0`
- Enterprise modules (private distribution): Commercial Proprietary License

Repository and release model:
- Private monorepo is the source of truth.
- Public community repository is generated by a mirror pipeline from `.oss-allowlist`.
- Community release artifacts include source, Docker images, and Apache-licensed SDK packages.

Engineering boundary model:
- `enterprise -> community` imports are allowed.
- `community -> enterprise` imports are forbidden and CI-gated.
- `apps/api` loads an optional enterprise provider via environment-controlled dynamic module loading.
- Community runtime must work with no enterprise package installed.

Governance model:
- CLA is required for contribution intake that can enter commercial licensing paths.
- Trademark policy is strict: code can be forked, branding cannot be reused without permission.

## Consequences
Positive:
- Stronger business moat than permissive-only licensing for an application-layer system.
- Keeps community self-host usability and ecosystem growth path.
- Reduces accidental proprietary exposure via policy + CI gates.

Tradeoffs:
- AGPL introduces adoption friction in some enterprise contexts.
- Requires disciplined boundaries, release automation, and legal review cadence.
- Community and enterprise feature planning must remain explicit to avoid unclear product lines.

## Alternatives Considered
- Permissive-only (`Apache-2.0`/`MIT`) for all server code: rejected for weak defensive moat.
- SSPL/source-available as primary public license: rejected due to OSI incompatibility and ecosystem friction.
- Single codebase dual-license only (no Open Core split): rejected for weaker product differentiation in this product category.

## Chinese Summary (for internal communication)
- 采用 Open Core：社区核心开源，企业能力闭源。
- 社区核心使用 AGPL，SDK 使用 Apache-2.0，企业模块使用商业许可证。
- 私有仓为真源，通过 allowlist 自动镜像到公开社区仓。
- 工程上强制 `community` 不得依赖 `enterprise`，并在 CI 阻断。
- 配套 CLA 与商标策略，保障商业化与品牌控制。
